# Access Control List for Sengled Local Server
# Controls which clients can access which topics

# ==============================================================================
# Default Rules
# ==============================================================================

# Default: deny all access (explicit security)
# Access is then granted on a per-topic basis below

# ==============================================================================
# Anonymous Access (Sengled Bulbs + Local Services)
# ==============================================================================

# Anonymous and authenticated access is now handled by pattern rules below
# This ensures both anonymous bulbs and SDK-username bulbs get the same permissions

# Allow local services (like our MQTT listener) to read all device data
# This enables device discovery by the HTTP server's MQTT listener
topic read wifielement/+/status
topic read wifielement/+/consumption
topic read wifielement/+/consumptionTime
topic read wifielement/+/attributes
topic read wifielement/+/state

# ==============================================================================
# Administrative Access
# ==============================================================================

# If authentication is enabled, admin users get full access
user admin
topic readwrite #

# Bridge connection access (if using authentication)
user bridge
topic readwrite wifielement/#

# Pattern-based rules apply to ALL users (anonymous + any username variants)
# This covers both anonymous bulbs and SDK-enabled bulbs with dynamic usernames

# Sengled bulbs can publish to their own status topics  
pattern write wifielement/+/status
pattern write wifielement/+/consumption
pattern write wifielement/+/consumptionTime  
pattern write wifielement/+/attributes
pattern write wifielement/+/state

# Sengled bulbs can subscribe to their own command/update topics
pattern read wifielement/+/update
pattern read wifielement/+/command  
pattern read wifielement/+/set

# ==============================================================================
# System Topics
# ==============================================================================

# Allow everyone to read system status topics
topic read $SYS/#

# ==============================================================================
# Local Management Topics
# ==============================================================================

# Allow local management topics for add-on control
topic readwrite sengled/addon/+
topic readwrite sengled/status/+

# ==============================================================================
# Additional Security Notes
# ==============================================================================

# The %c placeholder represents the client ID, so bulbs can only
# access topics that match their MAC address (client ID).
# This prevents bulbs from interfering with each other.

# Topics starting with $ are reserved for system use
# Topics starting with sengled/ are for add-on management

# For maximum security in production:
# 1. Enable authentication (remove allow_anonymous)
# 2. Use client certificates for bulbs
# 3. Implement more restrictive topic patterns
# 4. Consider using username/password for bridge connection