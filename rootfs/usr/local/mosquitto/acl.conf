# Access Control List for Sengled Local Server
# Controls which clients can access which topics

# ==============================================================================
# Default Rules
# ==============================================================================

# Default: deny all access (explicit security)
# Access is then granted on a per-topic basis below

# ==============================================================================
# Anonymous Access (Sengled Bulbs + Local Services)
# ==============================================================================

# Allow anonymous clients (Sengled bulbs) to:
# 1. Publish their status, consumption, and other data
# 2. Subscribe to their own update topics for commands

# Sengled bulbs can publish to their own status topics  
# Bulbs connect as "MAC@wifielement", so we'll use broad topic access for simplicity
topic write wifielement/+/status
topic write wifielement/+/consumption
topic write wifielement/+/consumptionTime  
topic write wifielement/+/attributes
topic write wifielement/+/state

# Sengled bulbs can subscribe to their own command/update topics
topic read wifielement/+/update
topic read wifielement/+/command  
topic read wifielement/+/set

# Allow local services (like our MQTT listener) to read all device data
# This enables device discovery by the HTTP server's MQTT listener
topic read wifielement/+/status
topic read wifielement/+/consumption
topic read wifielement/+/consumptionTime
topic read wifielement/+/attributes
topic read wifielement/+/state

# ==============================================================================
# Administrative Access
# ==============================================================================

# If authentication is enabled, admin users get full access
user admin
topic readwrite #

# Bridge connection access (if using authentication)
user bridge
topic readwrite wifielement/#

# ==============================================================================
# System Topics
# ==============================================================================

# Allow everyone to read system status topics
topic read $SYS/#

# ==============================================================================
# Local Management Topics
# ==============================================================================

# Allow local management topics for add-on control
topic readwrite sengled/addon/+
topic readwrite sengled/status/+

# ==============================================================================
# Additional Security Notes
# ==============================================================================

# The %c placeholder represents the client ID, so bulbs can only
# access topics that match their MAC address (client ID).
# This prevents bulbs from interfering with each other.

# Topics starting with $ are reserved for system use
# Topics starting with sengled/ are for add-on management

# For maximum security in production:
# 1. Enable authentication (remove allow_anonymous)
# 2. Use client certificates for bulbs
# 3. Implement more restrictive topic patterns
# 4. Consider using username/password for bridge connection